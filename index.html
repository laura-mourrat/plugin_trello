<!-- index.html : Power-Up Trello simple pour afficher les checklists sur la face de la carte -->
<html>
<head>
  <script src="https://p.trellocdn.com/power-up.min.js"></script>
  <style>
    body {
      font-family: sans-serif;
      font-size: 14px;
      padding: 10px;
    }
    ul {
      padding-left: 20px;
    }
    .done {
      text-decoration: line-through;
      color: gray;
    }
  </style>
</head>
<body>
  <div id="content">Chargement des checklists...</div>

  <script>
    const t = TrelloPowerUp.iframe();

    t.card('id').then(function(card) {
      t.get('card', 'shared', 'checklistData', null).then(function(data) {
        if (data) {
          renderChecklists(data);
        } else {
          // Charger les vraies checklists
          t.getRestApi().get(`/cards/${card.id}/checklists`).then(function(checklists) {
            t.set('card', 'shared', 'checklistData', checklists).then(() => {
              renderChecklists(checklists);
            });
          });
        }
      });
    });

    function renderChecklists(checklists) {
      const container = document.getElementById('content');
      container.innerHTML = '';
      checklists.forEach(cl => {
        const section = document.createElement('div');
        section.innerHTML = `<strong>${cl.name}</strong>`;
        const ul = document.createElement('ul');
        cl.checkItems.forEach(item => {
          const li = document.createElement('li');
          li.textContent = item.name;
          if (item.state === 'complete') li.className = 'done';
          ul.appendChild(li);
        });
        section.appendChild(ul);
        container.appendChild(section);
      });
    }
  </script>
</body>
</html>
